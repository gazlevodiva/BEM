<!doctype html>
<html lang="ru">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <link href="css/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <script src="js/Styles.js"></script>

    <title>Бизнес-Эмулятор 3000</title>
  </head>
  <body>

  	<div class="d-flex fixed-top flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
	  <h5 class="my-0 mr-md-auto font-weight-normal">Бизнес-Эмулятор 3000</h5>
	  <nav class="my-2 my-md-0 mr-md-3">
	    <a class="p-2 text-dark js-scroll-trigger" href="#">Рынок</a>
	    <a class="p-2 text-dark js-scroll-trigger" href="#cashflow">CashFlow</a>
	    <a class="p-2 text-dark js-scroll-trigger" href="#chart">График</a>
	  </nav>
	</div>


    <div class="container mt-5">
    	<div class="row">

    		<!-- SETTINGS ELEMENTS-->
    		<div class="col-md-10">

		    	<!-- MARKET -->
			    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center" id="market">
				  <h1 class="display-4">Рынок</h1>
				  <p class="lead">Добавляй новый рынок и задавай ему верные настройки</p>
				</div>
				<div class="container">
				  <div class="card-deck mb-3 text-center d-flex justify-content-center">

				  	<!-- PLACE FOR MARKET -->

				    <div class="card mb-4 shadow-sm" style="background-color:rgba(0,0,0,.03);" id="add_market_btn">
				      <div class="card-body d-flex justify-content-center">
				        <button type="button" class="btn btn-block btn-outline-secondary" style="border: none;" onclick="add_market()"><i class="fas fa-plus"></i></button>
				      </div>
				    </div>

				  </div>
				</div>

				<!-- CASHFLOW -->
				<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center" id="cashflow">
				  <h1 class="display-4">CashFlow</h1>
				</div>
				<div class="container">
				  <div class="card-deck mb-3 text-center">



				    <div class="card mb-4 shadow-sm">
				      <div class="card-header">
				        <h4 class="my-0 font-weight-normal">Штат</h4>
				      </div>
				      <div class="card-body">
				        <h2 class="card-title pricing-card-title">50 cпец<small class="text-muted" id="staff_year"></small></h2>
				        <ul class="list-unstyled mt-3 mb-4" id="market_specs">
					          <li>55 / 2021</li>
					          <li>65 / 2022</li>
					          <li>...</li>
					    </ul>
				        <button type="button" class="btn btn-lg btn-block btn-outline-secondary">Настройки</button>
				      </div>
				    </div>

				    <div class="card mb-4 shadow-sm">
				      <div class="card-header">
				        <h4 class="my-0 font-weight-normal">Прибыль</h4>
				      </div>
				      <div class="card-body">
				        <h2 class="card-title pricing-card-title">80%<small class="text-muted" id="profit_year"></small></h2>
				        <button type="button" class="btn btn-lg btn-block btn-outline-secondary">Настройки</button>
				      </div>
				    </div>

				    <div class="card mb-4 shadow-sm">
				      <div class="card-header">
				        <h4 class="my-0 font-weight-normal">Инвестор</h4>
				      </div>
				      <div class="card-body">
				        <h2 class="card-title pricing-card-title">$2.9m/3%<small class="text-muted" id="investor_year"></small></h2>
				        <button type="button" class="btn btn-lg btn-block btn-outline-secondary">Настройки</button>
				      </div>
				    </div>

				    <div class="card mb-4 shadow-sm">
				      <div class="card-header">
				        <h4 class="my-0 font-weight-normal">Кредит</h4>
				      </div>
				      <div class="card-body">
				        <h2 class="card-title pricing-card-title">$100к/10%<small class="text-muted" id="credit_year"></small></h2>
				        <button type="button" class="btn btn-lg btn-block btn-outline-secondary">Настройки</button>
				      </div>
				    </div>

				  </div>
				</div>



				<!-- PRODUCT READINESS-->
				<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
				    <h1 class="display-4">Готовность продукта</h1>
				    <div class="progress mt-5">
					    <div class="progress-bar progress-bar-striped bg-info" 
					         role="progressbar" 
					         style="width: 0%" 
					         aria-valuenow="50" 
					         aria-valuemin="0" 
					         aria-valuemax="100" 
					         id="product_readiness_progressbar">
					     	0%
					 	</div>
				    </div>
				</div>

				<!-- CHART -->
				<div class="mb-5" id="chart">
					<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
					  <h1 class="display-4">График</h1>
					</div>
					<canvas id="myChart"></canvas>
				</div>


				<!-- MODAL WINDOW -->
				<div id="add_modal_place"></div>
			
			</div>

			<!-- SLIDER -->
			<div class="col-md-2 mt-5 d-flex justify-content-center">
				<input type="range" id="vertical_slider" min='2020' max='2050' step="1" value='2020'/>
				<h2 class="text-center d-flex justify-content-center"id='current_year'>2020</h2>
			</div>

			<script>
				
				var year_slider = document.getElementById('vertical_slider');
				var current_year = document.getElementById('current_year');
				var staff_year = document.getElementById('staff_year');
				var profit_year = document.getElementById('profit_year');
				var investor_year = document.getElementById('investor_year');				
				var credit_year = document.getElementById('credit_year');
				var product_readiness_progressbar = document.getElementById('product_readiness_progressbar');


				var ctx = document.getElementById('myChart').getContext('2d');
				var config = {
				    // The type of chart we want to create
				    type: 'line',

				    // The data for our dataset
				    data: {
				        labels: [2020],
				        datasets: [{
				            label: 'Доля Рынка %',
				            backgroundColor: '#eab120',
				            borderColor: '#eab120',
				            data: [0],
				            fill: false,
				        },{
				            label: 'Затраты',
				            backgroundColor: '#090b35e8',
				            borderColor: '#090b35e8',
				            data: [0],
				            fill: false,
				        },]
				    },

				    // Configuration options go here
				    options: {
						responsive: true,
						title: {
							display: true,
						},
						tooltips: {
							mode: 'index',
							intersect: false,
						},
						hover: {
							mode: 'nearest',
							intersect: true
						},
						scales: {
							x: {
								display: true,
								scaleLabel: {
									display: true,
									labelString: 'Month'
								}
							},
							y: {
								display: true,
								scaleLabel: {
									display: true,
									labelString: 'Value'
								}
							}
						}
					}
				};
				var chart = new Chart(ctx, config);

				current_year.innerHTML = YEAR;
				staff_year.innerHTML = ' / '+YEAR;
				profit_year.innerHTML = ' / '+YEAR;
				investor_year.innerHTML = ' / '+YEAR;
				credit_year.innerHTML = ' / '+YEAR;
				product_readiness_progressbar.innerHTML = 0;

				var current_staff = 0;
				var current_market_specs = 0;
				var staff_productivity = 0;
				var market_specs_productivity = 0;

				year_slider.oninput = function() {
				    current_year.innerHTML = this.value;
				    staff_year.innerHTML = ' / '+this.value;
				    profit_year.innerHTML = ' / '+this.value;
				    investor_year.innerHTML = ' / '+this.value;
				    credit_year.innerHTML = ' / '+this.value;

			        // PRODUCT READINESS PROGRESS BAR
				    product_readiness_progressbar.innerHTML = Math.round(staff_productivity*(YEAR-CURRENT_YEAR))+'%';
				    product_readiness_progressbar.setAttribute("style", "width:"+staff_productivity*(YEAR-CURRENT_YEAR)+"%");


				    if (STAFF[YEAR] === undefined) {
					    current_staff = Object.values(STAFF)[Object.values(STAFF).length-1];
					}else{
						current_staff = STAFF[YEAR];
					}

					if (Market[0]['specs'][YEAR] === undefined) {
					    current_market_specs = Object.values(Market[0]['specs'])[Object.values(Market[0]['specs']).length-1];
					}else{
						current_market_specs = Market[0]['specs'][YEAR];
					}

					staff_productivity = 0.0954*current_staff;
					market_specs_productivity = 0.05*current_market_specs;


				    if(this.value > YEAR){
				  	    config.data.labels.push(this.value);

				  		// MARKET SHARE
				  		current_market_share = (staff_productivity+market_specs_productivity)*(YEAR-CURRENT_YEAR);
				  		config.data.datasets[0].data.push( current_market_share );

				  		// EXPENSES
				  		current_expenses = 50000 * (current_staff + current_market_specs) * 0.000001;
				  		config.data.datasets[1].data.push( current_expenses );


				    }else{
				  		config.data.labels.splice(-1, 1);

				    }



				    YEAR = this.value;
				    chart.update();


				}

			</script>

		</div>
	</div>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <!-- <script src="Chart.min.js"></script> -->
  </body>
</html>